; Mensagens padrão
msgLose: string "Sua nave chocou com um asteroide em alta velocidade, a nave perdeu pressao e BUM explodiu, contudo uma maquina do tempo  pode lhe levar de volta ao inicio                                                                                        Deseja jogar novamente                         [s]/[n]"
msgStart: string "Respire fundo, e aperte espaco          para iniciar (A e D para mover   W/D para acelerar)"
msgScore: string "ANOS LUZ"
msgWin: string " Voce passou pela chuva de            asteroides piloto. voce e um heroi       e salvou a missao e sua tripulacao             otimo trabalho"

Letra: var #1 ; variável que contém a letra digitada

; Strings para imprimir a 'imagem' na tela inicial
linhaIni0: string "                                        "
linhaIni1: string "                                        "
linhaIni2: string "   ANEL DE ASTEROIDES EM ANDROMEDA!     "
linhaIni3: string "                                        "
linhaIni4: string "	                                       "
linhaIni5: string " Um belo dia viajando pela galaxia      "  
linhaIni6: string " de Andromeda sua nave passa por um     "
linhaIni7: string " anel de asteroides.                    "
linhaIni8: string " A sua vida e a de sua tripulacao       "
linhaIni9: string " estao em perigo e dependem de voce, o  "
linhaIni10: string " piloto da aeronave, que deve proteger "
linhaIni11: string "  a sua tripulacao e garantir o sucesso " 
linhaIni12: string "  da missao Universo II                 "
linhaIni13: string "  O ANEL TEM 2000 ANOS LUZ (2 MINUTOS)  "

tela0Linha0  : string "                                        "
tela0Linha1  : string "                                        "
tela0Linha2  : string "                                        "
tela0Linha3  : string "                                        "
tela0Linha4  : string "                                        "
tela0Linha5  : string "                                        "
tela0Linha6  : string "                                        "
tela0Linha7  : string "                                        "
tela0Linha8  : string "                                        "
tela0Linha9  : string "                                        "
tela0Linha10 : string "                                        "
tela0Linha11 : string "                                        "
tela0Linha12 : string "                                        "
tela0Linha13 : string "                                        "
tela0Linha14 : string "                                        "
tela0Linha15 : string "                                        "
tela0Linha16 : string "                                        "
tela0Linha17 : string "                                        "
tela0Linha18 : string "                                        "
tela0Linha19 : string "                                        "
tela0Linha20 : string "                                        "
tela0Linha21 : string "                                        "
tela0Linha22 : string "                                        "
tela0Linha23 : string "                                        "
tela0Linha24 : string "                                        "
tela0Linha25 : string "                                        "
tela0Linha26 : string "                                        "
tela0Linha27 : string "                                        "
tela0Linha28 : string "                                        "
tela0Linha29 : string "                                        "	 

tela3Linha0  : string "         ||                             "
tela3Linha1  : string "         ||                             "
tela3Linha2  : string "         ||                             "
tela3Linha3  : string "         ||                             "
tela3Linha4  : string "         ||                             "
tela3Linha5  : string "         ||                             "
tela3Linha6  : string "         ||                             "
tela3Linha7  : string "NAO      ||                             "
tela3Linha8  : string "DESISTA  ||                             "
tela3Linha9  : string "         ||                             "
tela3Linha10 : string "         ||                             "
tela3Linha11 : string "         ||                             "
tela3Linha12 : string "         ||                             "
tela3Linha13 : string "         ||                             "
tela3Linha14 : string "         ||                             "
tela3Linha15 : string "^^^^^^^^ ||                             "
tela3Linha16 : string "^^^^^^^^ ||                             "
tela3Linha17 : string "^^^^^^^^ ||                             "
tela3Linha18 : string "         ||                             "
tela3Linha19 : string "         ||                             "
tela3Linha20 : string "         ||                             "
tela3Linha21 : string "^^^^^^^^ ||                             "
tela3Linha22 : string "^^^^^^^^ ||                             "
tela3Linha23 : string "^^^^^^^^ ||                             "
tela3Linha24 : string "         ||                             "
tela3Linha25 : string "         ||                             "
tela3Linha26 : string "         ||                             "
tela3Linha27 : string "^^^^^^^^ ||                             "
tela3Linha28 : string "^^^^^^^^ ||                             "
tela3Linha29 : string "^^^^^^^^ ||                             " 


tela2Linha0  : string "        |                               "
tela2Linha1  : string "        |                               "
tela2Linha2  : string "        |                               "
tela2Linha3  : string "O ANEL  |                               "
tela2Linha4  : string "ACABA   |                               "
tela2Linha5  : string "EM 2000 |                               "
tela2Linha6  : string "ANOS LUZ|                               "
tela2Linha7  : string "        |                               "
tela2Linha8  : string "        |                               "
tela2Linha9  : string "        |                               "
tela2Linha10 : string "        |                               "
tela2Linha11 : string "        |                               "
tela2Linha12 : string "^^^^^^^^|                               "
tela2Linha13 : string "^^^^^^^^|                               "
tela2Linha14 : string "^^^^^^^^|                               "
tela2Linha15 : string "        |                               "
tela2Linha16 : string "        |                               "
tela2Linha17 : string "        |                               "
tela2Linha18 : string "^^^^^^^^|                               "
tela2Linha19 : string "^^^^^^^^|                               "
tela2Linha20 : string "^^^^^^^^|                               "
tela2Linha21 : string "        |                               "
tela2Linha22 : string "        |                               "
tela2Linha23 : string "        |                               "
tela2Linha24 : string "^^^^^^^^|                               "
tela2Linha25 : string "^^^^^^^^|                               "
tela2Linha26 : string "^^^^^^^^|                               "
tela2Linha27 : string "        |                               "
tela2Linha28 : string "        |                               "
tela2Linha29 : string "        |                               " 

tela4Linha0  : string "                                        "
tela4Linha1  : string "                                        "
tela4Linha2  : string "                                        "
tela4Linha3  : string "                                        "
tela4Linha4  : string "                                        "
tela4Linha5  : string "                                        "
tela4Linha6  : string "                                        "
tela4Linha7  : string "                                        "
tela4Linha8  : string "                                        "
tela4Linha9  : string "                                        "
tela4Linha10 : string "                                        "
tela4Linha11 : string "                                        "
tela4Linha12 : string "                                        "
tela4Linha13 : string "                                        "
tela4Linha14 : string "                                        "
tela4Linha15 : string "                                        "
tela4Linha16 : string "                                        "
tela4Linha17 : string "                                        "
tela4Linha18 : string "                                        "
tela4Linha19 : string "                                        "
tela4Linha20 : string "                                        "
tela4Linha21 : string "                                        "
tela4Linha22 : string "                                        "
tela4Linha23 : string "                                        "
tela4Linha24 : string "                                        "
tela4Linha25 : string "                                        "
tela4Linha26 : string "                                        "
tela4Linha27 : string "                                        "
tela4Linha28 : string "                                        "
tela4Linha29 : string "                                        "

tela5Linha0  : string "                             | > > > > >"
tela5Linha1  : string "                             |  > > > > "
tela5Linha2  : string "                             | > > > > >"
tela5Linha3  : string "                             |  > > > > "
tela5Linha4  : string "                             | > > > > >"
tela5Linha5  : string "                             |  > > > > "
tela5Linha6  : string "                             | > > > > >"
tela5Linha7  : string "                             |  > > > > "
tela5Linha8  : string "                             | > > > > >"
tela5Linha9  : string "                             |  > > > > "
tela5Linha10 : string "                             | > > > > >"
tela5Linha11 : string "                             |  > > > > "
tela5Linha12 : string "                             | > > > > >"
tela5Linha13 : string "                             |  > > > > "
tela5Linha14 : string "                             | > > > > >"
tela5Linha15 : string "                             |  < < < < "
tela5Linha16 : string "                             | < < < < <"
tela5Linha17 : string "                             |  < < < < "
tela5Linha18 : string "                             | < < < < <"
tela5Linha19 : string "                             |  < < < < "
tela5Linha20 : string "                             | < < < < <"
tela5Linha21 : string "                             |  < < < < "
tela5Linha22 : string "                             | < < < < <"
tela5Linha23 : string "                             |          "
tela5Linha24 : string "                             |          "
tela5Linha25 : string "                             |  VEL:    "
tela5Linha26 : string "                             |          "
tela5Linha27 : string "                             |          "
tela5Linha28 : string "                             |          "
tela5Linha29 : string "                             |          "

tela6Linha0  : string "                              | > > > > "
tela6Linha1  : string "                              |  > > > >"
tela6Linha2  : string "                              | > > > > "
tela6Linha3  : string "                              |  > > > >"
tela6Linha4  : string "                              | > > > > "
tela6Linha5  : string "                              |  > > > >"
tela6Linha6  : string "                              | > > > > "
tela6Linha7  : string "                              |  > > > >"
tela6Linha8  : string "                              | > > > > "
tela6Linha9  : string "                              |  > > > >"
tela6Linha10 : string "                              | > > > > "
tela6Linha11 : string "                              |  > > > >"
tela6Linha12 : string "                              | > > > > "
tela6Linha13 : string "                              |  > > > >"
tela6Linha14 : string "                              | > > > > "
tela6Linha15 : string "                              |  < < < <"
tela6Linha16 : string "                              | < < < < "
tela6Linha17 : string "                              |  < < < <"
tela6Linha18 : string "                              | < < < < "
tela6Linha19 : string "                              |  < < < <"
tela6Linha20 : string "                              | < < < < "
tela6Linha21 : string "                              |  < < < <"
tela6Linha22 : string "                              | < < < < "
tela6Linha23 : string "                              |         "
tela6Linha24 : string "                              |         "
tela6Linha25 : string "                              |         "
tela6Linha26 : string "                              | 1000    "
tela6Linha27 : string "                              | ANOS LUZ"
tela6Linha28 : string "                              | POR     "
tela6Linha29 : string "                              | MINUTO  "

Inicio:

call StartScreen
call printScore

	loadn r1, #tela3Linha0		; Endereco onde comeca a primeira linha do cenario!!
	loadn r2, #2560             ;cor lima
	call ImprimeTela2   		;  Rotina de Impresao de Cenario na Tela Inteira

	loadn r1, #tela2Linha0	    ; Endereco onde comeca a primeira linha do cenario!!
	loadn r2, #0                ; cor branca
	call ImprimeTela2   		;  Rotina de Impresao de Cenario na Tela Inteira
	
	loadn r1, #tela4Linha0      ; Endereco onde comeca a primeira linha do cenario!!
	loadn r2, #512              ; cor verde
	call ImprimeTela2   		;  Rotina de Impresao de Cenario na Tela Inteira
	
	loadn r1, #tela5Linha0	    ; Endereco onde comeca a primeira linha do cenario!!
	loadn r2, #0                ; cor branca
	call ImprimeTela2   		;  Rotina de Impresao de Cenario na Tela Inteira
	
	loadn r1, #tela6Linha0	    ; Endereco onde comeca a primeira linha do cenario!!
	loadn r2, #2560             ; cor lima
	call ImprimeTela2   		;  Rotina de Impresao de Cenario na Tela Inteira

	loadn r0, #1099         ; Posicao inicial
	loadn r1, #0			; Contador do vetor de posições de objetos
	loadn r2, #0			; Contador da pontuação
	loadn r3, #2000			; Limite da pontuação	
	
rand: var #80			; Vetor de posições aleatórias dos objetos
	static rand + #0, #141
	static rand + #1, #96
	static rand + #2, #147
	static rand + #3, #54
	static rand + #4, #94
	static rand + #5, #16
	static rand + #6, #136
	static rand + #7, #137
	static rand + #8, #146
	static rand + #9, #13
	static rand + #10, #99
	static rand + #11, #18
	static rand + #12, #22
	static rand + #13, #60
	static rand + #14, #64
	static rand + #15, #134
	static rand + #16, #102
	static rand + #17, #103
	static rand + #18, #61
	static rand + #19, #14
	static rand + #20, #66
	static rand + #21, #145
	static rand + #22, #107
	static rand + #23, #92
	static rand + #24, #17
	static rand + #25, #12
	static rand + #26, #140
	static rand + #27, #19
	static rand + #28, #95
	static rand + #29, #11
	static rand + #30, #62
	static rand + #31, #142
	static rand + #32, #101
	static rand + #33, #63
	static rand + #34, #100
	static rand + #35, #59
	static rand + #36, #52
	static rand + #37, #105
	static rand + #38, #108
	static rand + #39, #51
	static rand + #40, #142
	static rand + #41, #97
	static rand + #42, #146
	static rand + #43, #55
	static rand + #44, #95
	static rand + #45, #15
	static rand + #46, #135
	static rand + #47, #136
	static rand + #48, #14
	static rand + #49, #13
	static rand + #50, #100
	static rand + #51, #19
	static rand + #52, #23
	static rand + #53, #59
	static rand + #54, #63
	static rand + #55, #133
	static rand + #56, #101
	static rand + #57, #102
	static rand + #58, #60
	static rand + #59, #15
	static rand + #60, #67
	static rand + #61, #144
	static rand + #62, #106
	static rand + #63, #91
	static rand + #64, #16
	static rand + #65, #13
	static rand + #66, #139
	static rand + #67, #20
	static rand + #68, #94
	static rand + #69, #11
	static rand + #70, #63
	static rand + #71, #140
	static rand + #72, #101
	static rand + #73, #63  ;até aqui ok
	static rand + #74, #101
	static rand + #75, #60
	static rand + #76, #52
	static rand + #77, #105
	static rand + #78, #108
	static rand + #79, #51

objs: var #10				; Vetor que armazena os 10 objetos simultâneos na tela
	static objs + #0, #0
	static objs + #1, #0
	static objs + #2, #0
	static objs + #3, #0
	static objs + #4, #0	
	static objs + #5, #0	
	static objs + #6, #0	
	static objs + #7, #0	
	static objs + #8, #0	
	static objs + #9, #0

		
	
call LoadVector				; Função para carregar o vetor no inicio

printHighway:				; Função que imprime a pista
	push r0
	push r1
	push r2
	loadn r2, #10			;posicao do print na tela
	loadn r7, #31			;posicao do print na tela
	loadn r0, #'|'
	loadn r1, #40			;incremeta pra ir na linha de baixo
	loadn r6, #1231			;condição de parada
printAgain:
	outchar r0, r2			;print 	
	outchar r0, r7			;print	
	add r2, r2, r1			;desce pra linha de baixo
	add r7, r7, r1			;desce pra linha de baixo
	cmp r7, r6				;compara se ja chegou ao final da tela, se sim para de printar, se nao continua
	jne printAgain
	pop r2
	pop r1
	pop r0

main:
	
incObs:
	
	call Delay
	inc r2					; Incremento da pontuação
	cmp r2, r3				; Compara para saber se o jogo terminou
	jeq WinScreen			; Se terminou, pula para a tela de jogo ganho
	call PrintScore			; Imprime a pontuação
	call printObj			; Imprime objetos
	call moveStarship			; Movimenta o nave
	inc r7

jmp main

ImprimeTela2: 	
	;  Rotina de Impresao de Cenario na Tela Inteira
	;  r1 = endereco onde comeca a primeira linha do Cenario
	;  r2 = cor do Cenario para ser impresso

	push r0	; protege o r3 na pilha para ser usado na subrotina
	push r1	; protege o r1 na pilha para preservar seu valor
	push r2	; protege o r1 na pilha para preservar seu valor
	push r3	; protege o r3 na pilha para ser usado na subrotina
	push r4	; protege o r4 na pilha para ser usado na subrotina
	push r5	; protege o r5 na pilha para ser usado na subrotina
	push r6	; protege o r6 na pilha para ser usado na subrotina

	loadn r0, #0  			; posicao inicial tem que ser o comeco da tela!
	loadn r3, #40  			; Incremento da posicao da tela!
	loadn r4, #41  			; incremento do ponteiro das linhas da tela
	loadn r5, #1200 		; Limite da tela!
	loadn r6, #tela0Linha0	; Endereco onde comeca a primeira linha do cenario!!
	
   ImprimeTela2_Loop:
		call ImprimeStr2
		add r0, r0, r3  		; incrementaposicao para a segunda linha na tela -->  r0 = R0 + 40
		add r1, r1, r4  		; incrementa o ponteiro para o comeco da proxima linha na memoria (40 + 1 porcausa do /0 !!) --> r1 = r1 + 41
		add r6, r6, r4  		; incrementa o ponteiro para o comeco da proxima linha na memoria (40 + 1 porcausa do /0 !!) --> r1 = r1 + 41
		cmp r0, r5				; Compara r0 com 1200
		jne ImprimeTela2_Loop	; Enquanto r0 < 1200

	pop r6	; Resgata os valores dos registradores utilizados na Subrotina da Pilha
	pop r5
	pop r4
	pop r3
	pop r2
	pop r1
	pop r0
rts
	
ApagaTela:
	push r0
	push r1
	
	loadn r0, #1200		; apaga as 1200 posicoes da Tela
	loadn r1, #' '		; com "espaco"
	
	   ApagaTela_Loop:	;label for(r0=1200;r3>0;r3--)
		dec r0
		outchar r1, r0
		jnz ApagaTela_Loop
 
	pop r1
	pop r0
rts	
	
ImprimeStr2:	; Rotina de Impresao de Mensagens:    r0 = Posicao da tela que o primeiro caractere da mensagem sera' impresso;  r1 = endereco onde comeca a mensagem; r2 = cor da mensagem.   
				; Obs: a mensagem sera' impressa ate' encontrar "/0"
	push r0		; protege o r0 na pilha para preservar seu valor
	push r1		; protege o r1 na pilha para preservar seu valor
	push r2		; protege o r1 na pilha para preservar seu valor
	push r3		; protege o r3 na pilha para ser usado na subrotina
	push r4		; protege o r4 na pilha para ser usado na subrotina
	push r5		; protege o r5 na pilha para ser usado na subrotina
	push r6		; protege o r6 na pilha para ser usado na subrotina
	
	
	loadn r3, #'\0'	; Criterio de parada
	loadn r5, #' '	; Espaco em Branco

   ImprimeStr2_Loop:	
		loadi r4, r1
		cmp r4, r3				; If (Char == \0)  vai Embora
		jeq ImprimeStr2_Sai
		cmp r4, r5				; If (Char == ' ')  vai Pula outchar do espaco para nao apagar outros caracteres
		jeq ImprimeStr2_Skip
		add r4, r2, r4			; Soma a Cor
		outchar r4, r0			; Imprime o caractere na tela
   		storei r6, r4
   ImprimeStr2_Skip:
		inc r0					; Incrementa a posicao na tela
		inc r1					; Incrementa o ponteiro da String
		inc r6
		jmp ImprimeStr2_Loop
	
   ImprimeStr2_Sai:	
	pop r6						; Resgata os valores dos registradores utilizados na Subrotina da Pilha
	pop r5
	pop r4
	pop r3
	pop r2
	pop r1
	pop r0
rts
	
printObj:					; Funcao que imprime os objetos
	push r1
	push r2
	push r3
	push r4
	push r5
	push r6
	push r7
	
	loadn r1, #0			; Inicia o iterador
	loadn r2, #10			; Limite do iterador
	loadn r3, #objs			; Armazena a posicao inicial do vetor de objetos
	loadn r5, #'o'			; Armazena o caractere z para impressão (foi modificado para um quadrado que é o objeto)
	loadn r6, #40			; Armazena 40 para incremento
	loadn r7, #' '			; Armazena espaço para apagar objeto
	
incCountPrintObj:
	loadi r4, r3						; Carrega o valor da posicao de r3 para r4
	call ShouldIEraseOrShouldINot		; Funcao que verifica se o objeto ainda esta na tela
	add r4, r4, r6						; Soma 40 a posicao do objeto
	call ShouldIPrintOrShouldINot		; Funcao que verifica se o objeto ainda esta na tela
	cmp r4, r0							; Compara a ponteiro do objeto com o nave, para saber se houve colisao
	jeq Lose							; Se houve colisao, pula para Lose
	storei r3, r4						; Armazena o novo valor da posicao do objeto
	inc r3								; Incrementa posicao do vetor
	inc r1								; Incrementa iterador
	cmp r1, r2							; Compara se iterador chegou ao fim
	jne incCountPrintObj
	
	pop r7
	pop r6
	pop r5
	loadn r2, #1200
	cmp r4, r2				; Compara se o ultimo objeto chegou ao fim da tela
	pop r4
	pop r3
	pop r2
	pop r1
	cgr LoadVector			; Se chegou, chama a função que carrega o vetor de objetos
rts

printStarship:
    push r6

    loadn r6, #1148   ;cor do obj 
    loadn r7, #40

    outchar r6, r0      ; Imprime a primeira parte do nave
    inc r6              ; Incrementa r6 para mudar o caractere para a segunda parte do nave
    add r0, r0, r7      ; Soma 40 a posicao para imprimir na linha de baixo
    outchar r6, r0      ; Imprime a segunda parte do nave
    sub r0, r0, r7      ; Decrementa 40 para voltar a linha de cima

    pop r6
rts

moveStarshipL:
    push r6

    loadn r6, #40
    mod r7, r0, r6      ; Calcula o modulo por 40
    loadn r6, #11       ; Estipula um valor para o nave nao passar
    cmp r7, r6          ; Compara se a posicao é igual ao valor
    jeq dontMoveL       ; Nao realiza a movimentacao

    call eraseStarship
    dec r0
    call printStarship

dontMoveL:
    pop r6
rts

moveStarshipR:
    push r6

    loadn r6, #40

    mod r7, r0, r6      ; Calcula o modulo por 40
    loadn r6, #28       ; Estipula um valor para o nave nao passar
    cmp r7, r6          ; Compara se a posicao é igual ao valor
    jeq dontMoveR       ; Nao realiza a movimentacao

    call eraseStarship
    inc r0              ; Realiza a movimentacao
    call printStarship

dontMoveR:
    pop r6
rts

eraseStarship:
    loadn r7, #40
    outchar r5, r0      ; Apaga a primeira parte do nave
    add r0, r0, r7      ; Soma 40 a posicao para imprimir na linha de baixo
    outchar r5, r0      ; Apaga a segunda parte do nave
    sub r0, r0, r7      ; Decrementa 40 para voltar a linha de cima
rts


Delay:					;Controla a velocidade da movimentacao
	push r1
	push r2
	push r3
	
	loadn r2, #400
	loadn r3, #0
	
loadR1:					;Conta de 250 a 0	
	loadn r1, #300
	
decR1:					;Conta de 300 a 0
	dec r1
	cmp r1, r3
	jne decR1
	
	dec r2
	cmp r2, r3
	jne loadR1
	
	pop r3
	pop r2
	pop r1
rts

moveStarship:
	
	push r2
	push r4
	push r5
	
	loadn r2, #'a'          ; Armazena caractere 'a' para comparacao
	loadn r4, #'d'          ; Armazena caractere 'd' para comparacao
	loadn r5, #' '          ; Armazena caractere ' ' para comparacao

	
	call printStarship

    inchar r7           ; Le um valor do teclado e coloca em r7
    cmp r7, r2          ; Compara o valor lido com 'a'
    ceq moveStarshipL        ; Se for igual, movimenta o nave para a eraseC
    cmp r7, r4          ; Compara o valor lido com 'd'
    ceq moveStarshipR        ; Se for igual, movimenta o nave para a direita
	pop r5
	pop r4
	pop r2
rts

LoadVector:					; Funcao que carrega o vetor de 15 objetos

	push r2
	push r3
	push r4
	push r5
	push r6
	
	loadn r2, #rand			; Carrega r2 com a posicao inicial do vetor de posicoes
	add r2, r2, r1			; Soma com o indice para saber a partir de qual deve-se armazenar
	
	loadn r3, #0			; Inicia o iterador
	loadn r4, #10			; Limite do iterador
	loadn r5, #objs			; Armazena a posicao inicial do vetor de objetos

IncLoadVector:

	inc r1
	inc r3
	loadi r6, r2			; Carrega r6 com o valor apontado por r2
	inc r2					; Incrementa r2 para andar com o ponteiro
	storei r5, r6			; Armazena o valor de r6 no vetor de objetos
	inc r5					; Incrementa r5 para andar com o ponteiro
	cmp r3, r4				; Compara se iterador chegou ao fim
	jne IncLoadVector		; Se não, volta para o loop
	
	loadn r2, #80		; Posicao final do vetor de posicoes
	cmp r1, r2				; Comprara com o contador de index
	ceq Reset				; Se for igual, reseta o contador de index
	
	pop r6
	pop r5
	pop r4
	pop r3
	pop r2
rts

Reset:
	loadn r1, #0			; Reseta o index para a primeira posicao
rts

Imprimestr:		;  Rotina de Impresao de Mensagens:    
				; r0 = Posicao da tela que o primeiro caractere da mensagem sera' impresso
				; r1 = endereco onde comeca a mensagem
				; r2 = cor da mensagem
				; Obs: a mensagem sera' impressa ate' encontrar "/0"
				
; Empilhamento: protege os registradores utilizados na subrotina na pilha para preservar seu valor				
	push r0	; Posicao da tela que o primeiro caractere da mensagem sera' impresso
	push r1	; endereco onde comeca a mensagem
	push r2	; cor da mensagem
	push r3	; Criterio de parada
	push r4	; Recebe o codigo do caractere da Mensagem
	
	loadn r3, #'\0'	; Criterio de parada

ImprimestrLoop:	
	loadi r4, r1		; aponta para a memoria no endereco r1 e busca seu conteudo em r4
	cmp r4, r3			; compara o codigo do caractere buscado com o criterio de parada
	jeq ImprimestrSai	; goto Final da rotina
	add r4, r2, r4		; soma a cor (r2) no codigo do caractere em r4
	outchar r4, r0		; imprime o caractere cujo codigo está em r4 na posicao r0 da tela
	inc r0				; incrementa a posicao que o proximo caractere sera' escrito na tela
	inc r1				; incrementa o ponteiro para a mensagem na memoria
	jmp ImprimestrLoop	; goto Loop
	
ImprimestrSai:	
; Desempilhamento: resgata os valores dos registradores utilizados na Subrotina da Pilha
	pop r4	
	pop r3
	pop r2
	pop r1
	pop r0
rts		; retorno da subrotina

Lose:						;Funcao de perda
	call eraseStarship
	call IncApagaTela
	loadn r0, #40 			; Posiciona a mensagem
	loadn r1, #msgLose		; Carrega o inicio da mensagem
	loadn r2, #1536			; Cor da mensagem teal
	call Imprimestr			; Imprime a mensagem
	call AskContinue		; Espera tecla para saber se quer jogar novamente
	
AskContinue:	
	call DigLetra
	loadn r0, #'n'
	load r1, Letra
	cmp r0, r1				; tecla == 'n' ?
	jeq AskContinueEndGame	; tecla e' 'n'
	
	loadn r0, #'s'
	cmp r0, r1				; tecla == 's' ?
	jne AskContinue	        ; tecla nao e' 's'
	
		
	; Se quiser jogar novamente...
	call IncApagaTela
	
	pop r2
	pop r1
	pop r0

	pop r0					; Da um Pop a mais para acertar o ponteiro da pilha, pois nao vai dar o RTS !!
	jmp Inicio

 AskContinueEndGame:
	call IncApagaTela
	halt
	
IncApagaTela:		; Funcao que apaga a tela
	push r0
	push r1
	push r2
	loadn r0, #0
	loadn r1, #1200
	loadn r2, #' '
ApagaLoop:
	outchar r2, r0
	inc r0
	cmp r0, r1
	jne ApagaLoop
	pop r2 
	pop r1
	pop r0
rts
	
StartScreen:			; Imprime a tela de inicio
	push r0
	push r1
	push r2
	push r3
	push r4
	
	loadn r1, #linhaIni0
	loadn r2, #2560		;cor lima
	call ImprimeTela
	
	loadn r0, #689
	loadn r1, #msgStart
	loadn r2, #0		;cor
	call Imprimestr
	loadn r4, #' '
StartLoop:
	inchar r3
	cmp r3, r4
	jne StartLoop
	call IncApagaTela
	pop r4
	pop r3
	pop r2
	pop r1
	pop r0
rts
	
printScore:						; Imprime o mensagem de score
	loadn r0, #0
	loadn r1, #msgScore
	loadn r2, #0	
	call Imprimestr
rts

ShouldIPrintOrShouldINot:		; Verifica se o nave ultrapassou a tela, se não, imprime
	push r0
	loadn r0, #1200
	cmp r4, r0
	jeg NotPrint
	outchar r5, r4
NotPrint:
	pop r0
rts
	
ShouldIEraseOrShouldINot: 		; Verifica se o nave ultrapassou a tela, se não, apaga
	push r0
	loadn r0, #1200
	cmp r4, r0
	jeg NotPrint
	outchar r7, r4
NotPrint:
	pop r0
rts
	
PrintScore:			   ; Imprime valor do score
	push r0
	push r1
	push r2
	push r3
	push r4
	push r5
	push r6
	push r7
	
	loadn r0, #43     ;Posicao do print na tela
	loadn r1, #10
	loadn r4, #'0'
 	loadn r5, #2816;cor do obj
	
LoopPrintScore:
	mod r3, r2, r1
	add r3, r3, r4
	add r3, r3, r5
	outchar r3, r0
	dec r0
	jz StopPrintScore
	div r2, r2, r1
	jnz LoopPrintScore
	
StopPrintScore:
	
	pop r7
	pop r6
	pop r5
	pop r4
	pop r3
	pop r2
	pop r1
	pop r0
rts

ImprimeTela: 	;  Rotina de Impresao de Cenario na Tela Inteira
				;  r1 = endereco onde comeca a primeira linha do Cenario
				;  r2 = cor do Cenario para ser impresso

	push r0	; protege o r3 na pilha para ser usado na subrotina
	push r1	; protege o r1 na pilha para preservar seu valor
	push r2	; protege o r1 na pilha para preservar seu valor
	push r3	; protege o r3 na pilha para ser usado na subrotina
	push r4	; protege o r4 na pilha para ser usado na subrotina
	push r5	; protege o r4 na pilha para ser usado na subrotina

	loadn r0, #80  	; posicao inicial tem que ser o comeco da tela!
	loadn r3, #40  	; Incremento da posicao da tela!
	loadn r4, #41  	; incremento do ponteiro das linhas da tela
	loadn r5, #640 ; Limite da tela!
	
   ImprimeTela_Loop:
		call Imprimestr
		add r0, r0, r3  		; incrementaposicao para a segunda linha na tela -->  r0 = R0 + 40
		add r1, r1, r4  		; incrementa o ponteiro para o comeco da proxima linha na memoria (40 + 1 porcausa do /0 !!) --> r1 = r1 + 41
		cmp r0, r5				; Compara r0 com 1200
		jne ImprimeTela_Loop	; Enquanto r0 < 1200

	pop r5	; Resgata os valores dos registradores utilizados na Subrotina da Pilha
	pop r4
	pop r3
	pop r2
	pop r1
	pop r0
rts
  
WinScreen:						;Tela de fim
	loadn r5, #0
	call IncApagaTela
	call PrintScore
	call printScore
	loadn r0, #607				;pos da msg
	loadn r1, #msgWin
	loadn r2, #2560				;cor da msg
	call Imprimestr
	call wait_key_2

wait_key_2:
	push r0
	push r1
	loadn r0, #' '
wait_key_loop_2:
	inchar r1
	cmp r1, r0
	jne wait_key_loop_2
	call IncApagaTela
	jmp Inicio
	
DigLetra:			; Espera que uma tecla seja digitada e salva na variavel global "Letra"
	push r0
	push r1
	loadn r1, #255	; Se nao digitar nada vem 255

   DigLetra_Loop:
		inchar r0			; Le o teclado, se nada for digitado = 255
		cmp r0, r1			;compara r0 com 255
		jeq DigLetra_Loop	; Fica lendo ate' que digite uma tecla valida

	store Letra, r0			; Salva a tecla na variavel global "Letra"

	pop r1
	pop r0
rts	
